<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Tracker</title>
    <style>
        /* ====================== Глобальные стили ====================== */
        
         :root {
            --primary-bg: #0A0A0A;
            --secondary-bg: #161616;
            --task-bg: #222222;
            --accent-red: #FF3B30;
            --accent-orange: #FF9500;
            --accent-blue: #007AFF;
            --text-primary: #B0B0B0;
            --text-secondary: #777777;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        /* ====================== Хедер ====================== */
        
        header {
            background: var(--secondary-bg);
            padding: 1.5rem;
            border-bottom: 1px solid #333;
            text-align: center;
        }
        
        h1 {
            font-weight: 300;
            letter-spacing: 0.05em;
            font-size: 1.8rem;
        }
        /* ====================== Основной контент ====================== */
        
        .container-wrapper {
            flex: 1;
            overflow: hidden;
            position: relative;
        }
        
        .container {
            display: flex;
            height: calc(100vh - 120px);
            padding: 1rem;
            gap: 1.5rem;
            overflow-x: auto;
        }
        /* ====================== Секции ====================== */
        
        .section {
            background: var(--secondary-bg);
            border-radius: 0.8rem;
            min-width: 320px;
            width: 320px;
            height: 100%;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .section-header {
            padding: 1rem;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-title {
            font-size: 1.1rem;
            font-weight: 500;
        }
        
        .task-count {
            background: #333;
            padding: 0.2rem 0.8rem;
            border-radius: 1rem;
            font-size: 0.9rem;
        }
        /* ====================== Задачи ====================== */
        
        .task-list {
            padding: 1rem;
            overflow-y: auto;
            flex: 1;
        }
        
        .task {
            background: var(--task-bg);
            border-radius: 0.6rem;
            padding: 1.2rem;
            margin-bottom: 0.8rem;
            cursor: grab;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 4px solid transparent;
            position: relative;
        }
        
        .task:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }
        
        .task.priority-high {
            border-color: var(--accent-red);
        }
        
        .task.priority-medium {
            border-color: var(--accent-orange);
        }
        
        .task.priority-low {
            border-color: var(--accent-blue);
        }
        
        .task-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.8rem;
        }
        
        .task-title {
            font-size: 1rem;
            font-weight: 500;
            max-width: 80%;
        }
        
        .task-priority {
            font-size: 0.8rem;
            padding: 0.2rem 0.6rem;
            border-radius: 0.4rem;
        }
        
        .priority-high {
            background: rgba(255, 59, 48, 0.15);
            color: var(--accent-red);
        }
        
        .priority-medium {
            background: rgba(255, 149, 0, 0.15);
            color: var(--accent-orange);
        }
        
        .priority-low {
            background: rgba(0, 122, 255, 0.15);
            color: var(--accent-blue);
        }
        
        .task-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 1rem;
        }
        
        .task-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        /* ====================== Кнопки ====================== */
        
        .add-task {
            background: transparent;
            border: 2px dashed #333;
            color: var(--text-secondary);
            padding: 0.8rem;
            border-radius: 0.6rem;
            cursor: pointer;
            transition: all 0.25s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .add-task:hover {
            border-color: var(--accent-red);
            color: var(--accent-red);
        }
        /* ====================== Модальные окна ====================== */
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal {
            background: var(--secondary-bg);
            border-radius: 0.8rem;
            width: 480px;
            padding: 1.5rem;
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .modal-title {
            font-size: 1.3rem;
            font-weight: 500;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            transition: opacity 0.2s;
        }
        
        .close-modal:hover {
            opacity: 0.8;
        }
        /* ====================== Формы ====================== */
        
        .form-group {
            margin-bottom: 1.2rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        input,
        textarea,
        select {
            width: 100%;
            padding: 0.8rem;
            background: var(--task-bg);
            border: 1px solid #333;
            border-radius: 0.4rem;
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: border-color 0.2s;
        }
        
        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--accent-blue);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
            line-height: 1.5;
        }
        
        .form-actions {
            display: flex;
            gap: 0.8rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }
        
        .btn {
            padding: 0.8rem 1.5rem;
            border-radius: 0.4rem;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-cancel {
            background: transparent;
            border: 1px solid #333;
            color: var(--text-primary);
        }
        
        .btn-cancel:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .btn-primary {
            background: var(--accent-red);
            color: white;
            border: none;
        }
        
        .btn-primary:hover {
            background: #FF453A;
        }
        /* ====================== Контекстное меню ====================== */
        
        .context-menu {
            position: fixed;
            background: var(--secondary-bg);
            border-radius: 0.6rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            display: none;
            min-width: 180px;
        }
        
        .context-item {
            padding: 0.8rem 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            transition: background 0.2s;
        }
        
        .context-item:hover {
            background: rgba(255, 255, 255, 0.03);
        }
        
        .context-icon {
            width: 20px;
            height: 20px;
        }
        /* ====================== Анимации ====================== */
        
        @keyframes taskPulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.02);
            }
            100% {
                transform: scale(1);
            }
        }
        /* ====================== Утилиты ====================== */
        
        .drag-over {
            background: rgba(255, 59, 48, 0.05);
            border: 2px dashed var(--accent-red);
        }
        
        .hidden {
            display: none !important;
        }
    </style>
</head>

<body>
    <!-- Хедер -->
    <header>
        <h1>Project Tracker</h1>
    </header>

    <!-- Основной контент -->
    <div class="container-wrapper">
        <div class="container">
            <!-- Секции будут сгенерированы через JS -->
        </div>
    </div>

    <!-- Модальное окно -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Управление задачей</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="taskForm">
                <div class="form-group">
                    <label for="taskTitle">Название задачи</label>
                    <input type="text" id="taskTitle" required>
                </div>
                <div class="form-group">
                    <label for="taskDescription">Описание</label>
                    <textarea id="taskDescription" rows="4"></textarea>
                </div>
                <div class="form-group">
                    <label for="taskPriority">Приоритет</label>
                    <select id="taskPriority">
                        <option value="high">Высокий</option>
                        <option value="medium" selected>Средний</option>
                        <option value="low">Низкий</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="taskDeadline">Дедлайн</label>
                    <input type="date" id="taskDeadline">
                </div>
                <div class="form-group">
                    <label for="taskSection">Раздел</label>
                    <select id="taskSection">
                        <option value="Сделано">Сделано</option>
                        <option value="Делается">Делается</option>
                        <option value="В планах">В планах</option>
                        <option value="Брошено">Брошено</option>
                        <option value="Отложено">Отложено</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel">Отмена</button>
                    <button type="submit" class="btn btn-primary">Сохранить</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Контекстное меню -->
    <div class="context-menu" id="contextMenu">
        <div class="context-item" id="editTask">
            <svg class="context-icon" viewBox="0 0 24 24"><path fill="currentColor" d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83l3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> Редактировать
        </div>
        <div class="context-item" id="deleteTask">
            <svg class="context-icon" viewBox="0 0 24 24"><path fill="currentColor" d="M19 4h-3.5l-1-1h-5l-1 1H5v2h14M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6v12Z"/></svg> Удалить
        </div>
    </div>

    <script>
        class TaskManager {
            constructor() {
                this.sections = ['Сделано', 'Делается', 'В планах', 'Брошено', 'Отложено'];
                this.currentTask = null;
                this.init();
                this.loadFromLocalStorage();
            }

            init() {
                this.renderSections();
                this.setupEventListeners();
                this.setupDragAndDrop();
            }

            renderSections() {
                const container = document.querySelector('.container');
                this.sections.forEach(section => {
                    const sectionHTML = `
                        <div class="section" data-section="${section}">
                            <div class="section-header">
                                <h2 class="section-title">${section}</h2>
                                <span class="task-count">0</span>
                            </div>
                            <div class="task-list">
                                ${section === 'Делается' ? '<div class="add-task">+ Добавить задачу</div>' : ''}
                            </div>
                        </div>
                    `;
                    container.insertAdjacentHTML('beforeend', sectionHTML);
                });
            }

            setupEventListeners() {
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.add-task') ||
                        (e.target.closest('.filter-controls') && e.target.tagName === 'BUTTON')) {
                        this.openModal();
                    }
                });

                document.querySelectorAll('.close-modal, .btn-cancel').forEach(btn => {
                    btn.addEventListener('click', () => this.closeModal());
                });

                document.addEventListener('dblclick', (e) => {
                    const task = e.target.closest('.task');
                    if (task) this.showContextMenu(e, task);
                });

                document.getElementById('editTask').addEventListener('click', () => this.editTask());
                document.getElementById('deleteTask').addEventListener('click', () => this.deleteTask());
                document.getElementById('taskForm').addEventListener('submit', (e) => this.handleSubmit(e));
            }

            openModal(task = null) {
                this.currentTask = task;
                const modal = document.getElementById('modalOverlay');
                modal.style.display = 'flex';
                task ? this.populateForm(task) : document.getElementById('taskForm').reset();
            }

            closeModal() {
                document.getElementById('modalOverlay').style.display = 'none';
                this.currentTask = null;
            }

            populateForm(task) {
                document.getElementById('taskTitle').value = task.querySelector('.task-title').textContent;
                document.getElementById('taskDescription').value = task.querySelector('.task-description').textContent;
                document.getElementById('taskPriority').value = task.classList[1].split('-')[1];
                document.getElementById('taskDeadline').value = task.querySelector('.task-meta span').textContent.split(': ')[1];
                document.getElementById('taskSection').value = task.closest('.section').dataset.section;
            }

            handleSubmit(e) {
                e.preventDefault();
                const formData = this.getFormData();
                this.currentTask ? this.updateTask(this.currentTask, formData) : this.createTask(formData);
                this.closeModal();
                this.updateCounters();
                this.saveToLocalStorage();
            }

            getFormData() {
                return {
                    title: document.getElementById('taskTitle').value,
                    description: document.getElementById('taskDescription').value,
                    priority: document.getElementById('taskPriority').value,
                    deadline: document.getElementById('taskDeadline').value,
                    section: document.getElementById('taskSection').value
                };
            }

            createTask(data) {
                const taskHTML = `
                    <div class="task priority-${data.priority}" draggable="true">
                        <div class="task-header">
                            <h3 class="task-title">${data.title}</h3>
                            <span class="task-priority priority-${data.priority}">
                                ${this.getPriorityLabel(data.priority)}
                            </span>
                        </div>
                        <p class="task-description">${data.description}</p>
                        <div class="task-meta">
                            <span>Дедлайн: ${data.deadline}</span>
                            <span>Автор: Неизвестно</span>
                        </div>
                    </div>
                `;

                const section = this.getSectionElement(data.section);
                section.querySelector('.task-list').insertAdjacentHTML('beforeend', taskHTML);
            }

            updateTask(task, data) {
                task.querySelector('.task-title').textContent = data.title;
                task.querySelector('.task-description').textContent = data.description;
                task.querySelector('.task-priority').textContent = this.getPriorityLabel(data.priority);
                task.className = `task priority-${data.priority}`;
                task.querySelector('.task-meta span').textContent = `Дедлайн: ${data.deadline}`;

                const newSection = this.getSectionElement(data.section);
                if (newSection !== task.parentElement.parentElement) {
                    newSection.querySelector('.task-list').appendChild(task);
                }
            }

            deleteTask() {
                if (confirm('Вы уверены, что хотите удалить задачу?')) {
                    this.currentTask.remove();
                    this.closeModal();
                    this.updateCounters();
                    this.saveToLocalStorage();
                }
            }

            showContextMenu(e, task) {
                this.currentTask = task;
                const contextMenu = document.getElementById('contextMenu');
                contextMenu.style.display = 'block';
                contextMenu.style.left = `${e.pageX}px`;
                contextMenu.style.top = `${e.pageY}px`;

                const closeMenu = (e) => {
                    if (!contextMenu.contains(e.target)) {
                        contextMenu.style.display = 'none';
                        document.removeEventListener('click', closeMenu);
                    }
                };
                document.addEventListener('click', closeMenu);
            }

            getPriorityLabel(priority) {
                return {
                    high: 'Высокий',
                    medium: 'Средний',
                    low: 'Низкий'
                }[priority];
            }

            getSectionElement(sectionName) {
                return document.querySelector(`[data-section="${sectionName}"]`);
            }

            updateCounters() {
                document.querySelectorAll('.section').forEach(section => {
                    const count = section.querySelectorAll('.task').length;
                    section.querySelector('.task-count').textContent = count;
                });
            }

            setupDragAndDrop() {
                let draggedTask = null;

                document.addEventListener('dragstart', (e) => {
                    if (e.target.closest('.task')) {
                        draggedTask = e.target;
                        draggedTask.style.opacity = '0.5';
                    }
                });

                document.addEventListener('dragend', () => {
                    if (draggedTask) {
                        draggedTask.style.opacity = '1';
                        draggedTask = null;
                        this.saveToLocalStorage();
                    }
                });

                document.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    const taskList = e.target.closest('.task-list');
                    if (taskList) taskList.classList.add('drag-over');
                });

                document.addEventListener('dragleave', (e) => {
                    const taskList = e.target.closest('.task-list');
                    if (taskList) taskList.classList.remove('drag-over');
                });

                document.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const taskList = e.target.closest('.task-list');
                    if (taskList && draggedTask) {
                        taskList.appendChild(draggedTask);
                        taskList.classList.remove('drag-over');
                        this.updateCounters();
                        this.saveToLocalStorage();
                    }
                });
            }

            saveToLocalStorage() {
                const tasks = [];
                document.querySelectorAll('.section').forEach(section => {
                    const sectionName = section.dataset.section;
                    section.querySelectorAll('.task').forEach(task => {
                        tasks.push({
                            title: task.querySelector('.task-title').textContent,
                            description: task.querySelector('.task-description').textContent,
                            priority: task.classList[1].split('-')[1],
                            deadline: task.querySelector('.task-meta span').textContent.split(': ')[1],
                            section: sectionName
                        });
                    });
                });
                localStorage.setItem('tasks', JSON.stringify(tasks));
            }

            loadFromLocalStorage() {
                const savedData = localStorage.getItem('tasks');
                if (savedData) {
                    JSON.parse(savedData).forEach(task => {
                        this.createTask({
                            title: task.title,
                            description: task.description,
                            priority: task.priority,
                            deadline: task.deadline,
                            section: task.section
                        });
                    });
                    this.updateCounters();
                }
            }
        }

        new TaskManager();
    </script>
</body>

</html>